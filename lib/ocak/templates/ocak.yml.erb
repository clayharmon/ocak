# Ocak pipeline configuration
# Generated by `ocak init` — customize as needed

# Auto-detected project stack
stack:
  language: <%= language %>
<%- if framework -%>
  framework: <%= framework %>
<%- end -%>
<%- if test_command -%>
  test_command: "<%= test_command %>"
<%- end -%>
<%- if lint_command -%>
  lint_command: "<%= lint_command %>"
<%- end -%>
<%- if setup_command -%>
  setup_command: "<%= setup_command %>"
<%- end -%>
<%- if format_command -%>
  format_command: "<%= format_command %>"
<%- end -%>
<%- unless security_commands.empty? -%>
  security_commands:
<%- security_commands.each do |cmd| -%>
    - "<%= cmd %>"
<%- end -%>
<%- end -%>

# Pipeline settings
pipeline:
  max_parallel: 3
  poll_interval: 60
  worktree_dir: ".claude/worktrees"
  log_dir: "logs/pipeline"
  # cost_budget: 5.00  # Max USD per issue pipeline (uncomment to enable)

# Safety — controls which issues the pipeline will process
# Default (no config): only issues created by the current `gh` user
safety:
  allowed_authors: []            # Empty = current gh user only. Add usernames to allow others.
  # require_comment: "auto-ready"  # Require this exact comment from an allowed author
  max_issues_per_run: 5          # Circuit breaker: max issues processed per poll cycle

# GitHub label state machine
labels:
  ready: "auto-ready"
  in_progress: "in-progress"
  completed: "completed"
  failed: "pipeline-failed"

# Pipeline steps — customize by adding/removing/reordering
# Each step can optionally specify `model:` to override the default (haiku|sonnet|opus)
steps:
  - agent: implementer
    role: implement
  - agent: reviewer
    role: review
  - agent: implementer
    role: fix
    condition: has_findings
  - agent: reviewer
    role: verify
    condition: had_fixes
  - agent: security_reviewer
    role: security
  - agent: implementer
    role: fix
    condition: has_findings
    complexity: full          # skipped for simple issues
  - agent: documenter
    role: document
    complexity: full          # skipped for simple issues
  - agent: auditor
    role: audit
    complexity: full          # skipped for simple issues
  - agent: merger
    role: merge

# Agent file paths — override to use custom agents
agents:
  implementer: .claude/agents/implementer.md
  reviewer: .claude/agents/reviewer.md
  security_reviewer: .claude/agents/security-reviewer.md
  documenter: .claude/agents/documenter.md
  merger: .claude/agents/merger.md
  pipeline: .claude/agents/pipeline.md
  planner: .claude/agents/planner.md
  auditor: .claude/agents/auditor.md
<%- if defined?(monorepo) && monorepo -%>

# Monorepo — detected packages/workspaces
# Configure per-package test/lint commands here if needed
monorepo:
  detected: true
  packages:
<%- packages.each do |pkg| -%>
    - "<%= pkg %>"
<%- end -%>
<%- end -%>
